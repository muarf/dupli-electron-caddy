:8000 {
    # Logs pour debug
    log {
        output file /tmp/caddy_duplicator.log
        format console
        level INFO
    }

    # Security headers
    header {
        X-Content-Type-Options nosniff
        X-Frame-Options SAMEORIGIN
        X-XSS-Protection "1; mode=block"
        Referrer-Policy strict-origin-when-cross-origin
    }

    # CORS headers
    header {
        Access-Control-Allow-Origin "*"
        Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Access-Control-Allow-Headers "Content-Type, Authorization"
    }

    # Reverse proxy to PHP built-in server with increased timeouts
    reverse_proxy 127.0.0.1:8001 {
        # Timeouts augmentés pour les opérations lentes (traitement d'images, PDF)
        transport http {
            dial_timeout 10s
            read_timeout 120s
            write_timeout 120s
        }
        
        # Gestion des erreurs
        flush_interval -1
    }
}