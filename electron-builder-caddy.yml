appId: com.dupli.app
productName: Duplicator
directories:
  output: dist
icon: icons/icon.png
publish:
  provider: github
  releaseType: release
  publishAutoUpdate: true
files:
  - main-caddy.js
  - main.js
  - preload.js
  - Caddyfile
  - php-fpm.conf
  - php-install-guide.html
  - app/**/*
  - ghostscript/**/*
  - caddy/**/*
  # PHP sera inclus spécifiquement par plateforme (Windows/macOS oui, Linux non)
# asarUnpack configuré spécifiquement par plateforme pour éviter les erreurs de chemins longs
# Plus besoin d'exclure les liens symboliques car ils ont été supprimés
linux:
  target: 
    - target: AppImage
      arch: [x64]
  category: Office
  executableName: Duplicator
  executableArgs: ["--no-sandbox", "--disable-gpu", "--disable-setuid-sandbox"]
  # Configuration spécifique Linux - utilise PHP système, pas de binaires embarqués
  # Le dossier php/ est vidé avant le build dans le workflow (économie d'espace)
  # Désactiver ASAR sur Linux pour éviter l'erreur "file already exists"
  asar: false
  files:
    - main-caddy.js
    - main.js
    - preload.js
    - Caddyfile
    - php-fpm.conf
    - php-install-guide.html
    - app/**/*
    - ghostscript/**/*
    - caddy/**/*
    - "!php/**/*"  # Exclure le dossier php/ (vidé, utilise PHP système)
mac:
  target: 
    - target: dmg
      arch: [x64]
  category: public.app-category.productivity
  # Configuration spécifique macOS - inclut PHP
  files:
    - main-caddy.js
    - main.js
    - preload.js
    - Caddyfile
    - php-fpm.conf
    - php-install-guide.html
    - app/**/*
    - ghostscript/**/*
    - caddy/**/*
    - "php/**/*"  # Inclure PHP pour macOS
  asarUnpack:
    - "php/**/*"
    - "app/**/*"
    - "ghostscript/**/*"
    - "caddy/**/*"
    - "Caddyfile"
    - "php-fpm.conf"
win:
  target:
    - target: nsis
      arch: [x64]
    - target: portable
      arch: [x64]
    - target: zip
      arch: [x64]
  forceCodeSigning: false
  # Désactiver ASAR sur Windows pour éviter l'erreur "pattern is too long"
  asar: false
  # Configuration spécifique Windows - inclut PHP embarqué
  files:
    - main-caddy.js
    - main.js
    - preload.js
    - Caddyfile
    - php-fpm.conf
    - php-install-guide.html
    - app/**/*
    - ghostscript/**/*
    - caddy/**/*
    - "php/**/*"  # Inclure PHP pour Windows
nsis:
  oneClick: false
  allowToChangeInstallationDirectory: true
  createDesktopShortcut: true
  createStartMenuShortcut: true
  shortcutName: Duplicator
  deleteAppDataOnUninstall: false
  artifactName: Duplicator-Setup-${version}.exe
